# ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

## Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ (0.1)

### Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ĞºĞ¾Ğ´Ğ°:

```
bot.py
â”œâ”€â”€ ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
â”‚   â”œâ”€â”€ BOT_TOKEN
â”‚   â”œâ”€â”€ USER_DATA_FILE
â”‚   â””â”€â”€ TASKS (Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)
â”‚
â”œâ”€â”€ Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸
â”‚   â”œâ”€â”€ load_user_data()
â”‚   â”œâ”€â”€ save_user_data()
â”‚   â”œâ”€â”€ get_user()
â”‚   â””â”€â”€ update_user()
â”‚
â”œâ”€â”€ AI-Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ
â”‚   â””â”€â”€ generate_response()
â”‚
â””â”€â”€ ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´
    â”œâ”€â”€ /start
    â”œâ”€â”€ /help
    â”œâ”€â”€ /tasks
    â”œâ”€â”€ /respond
    â”œâ”€â”€ /balance
    â””â”€â”€ /my_responses
```

### Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:

**user_data.json:**
```json
{
  "123456789": {
    "balance": 150,
    "responses": [
      {
        "task_id": 1,
        "task_title": "ĞĞ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ñ€ĞµĞºĞ»Ğ°Ğ¼Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚",
        "response_text": "Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ! Ğ“Ğ¾Ñ‚Ğ¾Ğ² Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ...",
        "timestamp": "2025-11-14T15:30:00",
        "earned": 50
      }
    ],
    "created_at": "2025-11-14T15:00:00"
  }
}
```

---

## ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµĞ¼Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° (0.2+)

### ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°:

```
project/
â”œâ”€â”€ bot/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ°
â”‚   â”œâ”€â”€ config.py            # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
â”‚   â””â”€â”€ handlers/            # ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ start.py
â”‚       â”œâ”€â”€ tasks.py
â”‚       â”œâ”€â”€ responses.py
â”‚       â””â”€â”€ balance.py
â”‚
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ models.py            # SQLAlchemy Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
â”‚   â”œâ”€â”€ crud.py              # CRUD Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
â”‚   â””â”€â”€ migrations/          # Alembic Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ ai_service.py        # AI-Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ
â”‚   â”œâ”€â”€ freelance_api.py     # API Ğ±Ğ¸Ñ€Ğ¶
â”‚   â””â”€â”€ payment_service.py   # ĞŸĞ»Ğ°Ñ‚ĞµĞ¶Ğ¸
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ validators.py
â”‚   â””â”€â”€ helpers.py
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_handlers.py
â”‚   â”œâ”€â”€ test_services.py
â”‚   â””â”€â”€ test_database.py
â”‚
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .env                     # ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
â””â”€â”€ README.md
```

### Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (PostgreSQL):

```sql
-- Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
CREATE TABLE users (
    id BIGINT PRIMARY KEY,
    username VARCHAR(255),
    balance DECIMAL(10, 2) DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¾Ñ‚ĞºĞ»Ğ¸ĞºĞ¾Ğ²
CREATE TABLE responses (
    id SERIAL PRIMARY KEY,
    user_id BIGINT REFERENCES users(id),
    task_id INTEGER,
    task_title VARCHAR(500),
    response_text TEXT,
    earned DECIMAL(10, 2),
    created_at TIMESTAMP DEFAULT NOW()
);

-- Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğ¹ (ĞºÑÑˆ Ñ Ğ±Ğ¸Ñ€Ğ¶)
CREATE TABLE tasks (
    id SERIAL PRIMARY KEY,
    external_id VARCHAR(255),
    platform VARCHAR(50),
    title VARCHAR(500),
    description TEXT,
    budget DECIMAL(10, 2),
    category VARCHAR(100),
    created_at TIMESTAMP DEFAULT NOW()
);

-- Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¹
CREATE TABLE transactions (
    id SERIAL PRIMARY KEY,
    user_id BIGINT REFERENCES users(id),
    amount DECIMAL(10, 2),
    type VARCHAR(50),
    description TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

### API Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸:

```python
# services/freelance_api.py

class FreelanceAPI:
    """Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ API Ğ±Ğ¸Ñ€Ğ¶"""
    
    async def get_tasks(self, filters):
        """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğ¹"""
        pass
    
    async def send_response(self, task_id, text):
        """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚ĞºĞ»Ğ¸Ğº"""
        pass

class FLruAPI(FreelanceAPI):
    """API Ğ´Ğ»Ñ FL.ru"""
    pass

class KworkAPI(FreelanceAPI):
    """API Ğ´Ğ»Ñ Kwork"""
    pass
```

### AI-ÑĞµÑ€Ğ²Ğ¸Ñ:

```python
# services/ai_service.py

class AIService:
    """Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¾Ñ‚ĞºĞ»Ğ¸ĞºĞ¾Ğ²"""
    
    def __init__(self, provider='openai'):
        self.provider = provider
    
    async def generate_response(self, task, user_profile):
        """
        Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚ĞºĞ»Ğ¸Ğº
        
        Args:
            task: Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ
            user_profile: ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (Ğ½Ğ°Ğ²Ñ‹ĞºĞ¸, Ğ¾Ğ¿Ñ‹Ñ‚)
        
        Returns:
            str: Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚ĞºĞ»Ğ¸Ğº
        """
        if self.provider == 'openai':
            return await self._generate_openai(task, user_profile)
        elif self.provider == 'yandex':
            return await self._generate_yandex(task, user_profile)
```

---

## ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Ğ’ĞµÑ€ÑĞ¸Ñ 0.3: ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑÑ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Gateway   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”
â”‚ Bot   â”‚ â”‚ Web   â”‚
â”‚Serviceâ”‚ â”‚Serviceâ”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚        â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Message   â”‚
    â”‚   Queue     â”‚
    â”‚  (RabbitMQ) â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”
â”‚  AI   â”‚ â”‚ Task  â”‚
â”‚Serviceâ”‚ â”‚Scraperâ”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚        â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚Database â”‚
    â”‚(Postgresâ”‚
    â”‚ + Redis)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ:

- **ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:** Redis Ğ´Ğ»Ñ Ñ‡Ğ°ÑÑ‚Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- **ĞÑ‡ĞµÑ€ĞµĞ´Ğ¸:** RabbitMQ Ğ´Ğ»Ñ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸
- **Ğ‘Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€Ğ¾Ğ²ĞºĞ°:** Nginx Ğ´Ğ»Ñ Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
- **ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³:** Prometheus + Grafana

---

## Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ (0.1):
- âœ… Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- âœ… Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾

### ĞŸĞ»Ğ°Ğ½Ñ‹ (0.2+):
- ğŸ”’ Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² API
- ğŸ”’ Rate limiting (Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ ÑĞ¿Ğ°Ğ¼Ğ°)
- ğŸ”’ JWT Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°
- ğŸ”’ HTTPS Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹
- ğŸ”’ Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
- ğŸ”’ Ğ ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ñ‹Ğµ Ğ±ÑĞºĞ°Ğ¿Ñ‹ Ğ‘Ğ”

---

## Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ:
- Ğ ÑƒÑ‡Ğ½Ğ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´

### ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾Ğµ:
```python
# tests/test_handlers.py

import pytest
from bot.handlers import start, tasks, respond

@pytest.mark.asyncio
async def test_start_command():
    """Ğ¢ĞµÑÑ‚ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ /start"""
    message = MockMessage(text="/start")
    await start.cmd_start(message)
    assert "Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ" in message.answer_text

@pytest.mark.asyncio
async def test_respond_command():
    """Ğ¢ĞµÑÑ‚ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ /respond"""
    message = MockMessage(text="/respond 1")
    await respond.cmd_respond(message)
    assert message.user_balance == 50
```

---

## ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

```python
import logging
from prometheus_client import Counter, Histogram

# ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸
responses_total = Counter('responses_total', 'Total responses sent')
response_time = Histogram('response_time', 'Response generation time')

# Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('bot.log'),
        logging.StreamHandler()
    ]
)
```

---

## Ğ Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ

### Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ (0.1):
```bash
python bot.py
```

### ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾Ğµ (0.2+):

**Docker:**
```dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["python", "bot.py"]
```

**Docker Compose:**
```yaml
version: '3.8'
services:
  bot:
    build: .
    env_file: .env
    depends_on:
      - postgres
      - redis
  
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: freelance_bot
      POSTGRES_PASSWORD: ${DB_PASSWORD}
  
  redis:
    image: redis:7-alpine
```

**Kubernetes:**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: freelance-bot
spec:
  replicas: 3
  selector:
    matchLabels:
      app: freelance-bot
  template:
    metadata:
      labels:
        app: freelance-bot
    spec:
      containers:
      - name: bot
        image: freelance-bot:latest
        env:
        - name: BOT_TOKEN
          valueFrom:
            secretKeyRef:
              name: bot-secrets
              key: token
```
