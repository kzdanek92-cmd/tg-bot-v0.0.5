"""
AI Service
Сервис для AI-генерации откликов на задания
"""

import logging
import random
from typing import Dict, Any

logger = logging.getLogger(__name__)


class AIService:
    """
    Сервис для генерации откликов на задания
    
    В текущей версии использует шаблоны для генерации.
    В будущих версиях будет интегрирован с OpenAI/YandexGPT
    """
    
    def __init__(self):
        """Инициализация сервиса"""
        self.templates = {
            "Копирайтинг": [
                "Здравствуйте! Готов выполнить задание '{title}'. "
                "Имею опыт в копирайтинге, портфолио вышлю в личку. "
                "Срок выполнения: 1-2 дня. Жду вашего ответа!",
                
                "Добрый день! Заинтересовало ваше задание. "
                "Напишу качественный текст с учетом целевой аудитории. "
                "Готов приступить сразу после согласования деталей."
            ],
            "Креатив": [
                "Привет! Задание '{title}' выглядит интересно. "
                "Предложу несколько вариантов слоганов на выбор. "
                "Опыт работы с брендингом есть, примеры покажу.",
                
                "Здравствуйте! Креативные задачи — моя специализация. "
                "Разработаю несколько концепций под ваш бренд. Обсудим?"
            ],
            "Переводы": [
                "Добрый день! Выполню перевод качественно и в срок. "
                "Опыт технических переводов 3+ года. "
                "Гарантирую точность и соблюдение терминологии.",
                
                "Здравствуйте! Готов взяться за перевод. "
                "Носитель русского языка, отличное знание английского. "
                "Срок: 1 день."
            ],
            "SMM": [
                "Привет! Задание '{title}' мне подходит. "
                "Создам вовлекающий пост с учетом специфики LinkedIn. "
                "Есть опыт ведения бизнес-аккаунтов.",
                
                "Здравствуйте! Напишу пост, который зайдет вашей аудитории. "
                "Учту тренды и особенности платформы. Обсудим детали?"
            ]
        }
        logger.info("AIService инициализирован")
    
    def generate_response(self, task: Dict[str, Any]) -> str:
        """
        Генерирует отклик на задание
        
        В текущей версии использует случайный выбор из шаблонов.
        В будущих версиях будет использовать реальную AI-модель.
        
        Args:
            task: Словарь с данными задания (id, title, description, category, budget)
            
        Returns:
            Сгенерированный текст отклика
        """
        try:
            category = task.get("category", "Копирайтинг")
            title = task.get("title", "задание")
            
            # Получаем шаблоны для категории
            category_templates = self.templates.get(category, self.templates["Копирайтинг"])
            
            # Выбираем случайный шаблон
            template = random.choice(category_templates)
            
            # Форматируем шаблон
            response_text = template.format(title=title)
            
            logger.debug(f"Сгенерирован отклик для задания {task.get('id')} (категория: {category})")
            
            return response_text
            
        except Exception as e:
            logger.error(f"Ошибка генерации отклика: {e}")
            # Возвращаем базовый отклик в случае ошибки
            return f"Здравствуйте! Готов выполнить задание '{task.get('title', 'задание')}'. Обсудим детали?"
    
    def generate_custom_response(self, task: Dict[str, Any], user_profile: Dict[str, Any]) -> str:
        """
        Генерирует персонализированный отклик на основе профиля пользователя
        
        Эта функция будет использоваться в будущих версиях для
        персонализации откликов на основе навыков и опыта пользователя.
        
        Args:
            task: Словарь с данными задания
            user_profile: Словарь с данными профиля пользователя
            
        Returns:
            Персонализированный текст отклика
        """
        # TODO: Реализовать в версии 0.0.3 с интеграцией AI
        logger.warning("generate_custom_response еще не реализован, используется базовая генерация")
        return self.generate_response(task)
    
    def validate_response(self, response_text: str) -> bool:
        """
        Валидация сгенерированного отклика
        
        Args:
            response_text: Текст отклика для валидации
            
        Returns:
            True если отклик валиден, False иначе
        """
        # Проверка минимальной длины
        if len(response_text) < 20:
            logger.warning("Отклик слишком короткий")
            return False
        
        # Проверка максимальной длины
        if len(response_text) > 1000:
            logger.warning("Отклик слишком длинный")
            return False
        
        return True
